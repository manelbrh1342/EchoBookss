{% load static %} <!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Notifications</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
        integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
        <link href="https://cdn.jsdelivr.net/npm/remixicon@4.1.0/fonts/remixicon.css" rel="stylesheet" />
        <link
        href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap"
        rel="stylesheet">

    <link rel="stylesheet" href="{% static 'css/index.css' %} ">
    <style>.write-review-container {
        max-width: 900px;
        margin: 2rem auto;
        padding: 0 1rem;
    }

    .review-header {
        display: flex;
        align-items: center;
        margin-bottom: 2rem;
        gap: 1rem;
    }

    .review-header .back-btn {
        background: none;
        border: none;
        color: #6c757d;
        cursor: pointer;
        padding: 0.5rem;
        border-radius: 50%;
    }

    .review-header .back-btn:hover {
        background-color: #e9ecef;
    }

    .book-preview {
        background: white;
        padding: 1.5rem;
        border-radius: 12px;
        margin-bottom: 2rem;
        box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        display: flex;
        gap: 1.5rem;
    }

    .book-preview img {
        width: 100px;
        height: 150px;
        object-fit: cover;
        border-radius: 8px;
    }

    .book-info h4 {
        margin: 0;
        color: rgb(49, 45, 74);
    }

    .review-form {
        background: white;
        padding: 2rem;
        border-radius: 12px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.05);
    }

    .rating-select {
        margin-bottom: 2rem;
    }

    .star-rating {
        font-size: 2rem;
        color: #dee2e6;
        display: flex;
        gap: 0.5rem;
    }

    .star-rating i {
        cursor: pointer;
        transition: color 0.2s;
    }

    .star-rating i:hover,
    .star-rating i.active {
        color: #ffc107;
    }

    .form-group {
        margin-bottom: 1.5rem;
    }

    .form-group label {
        display: block;
        margin-bottom: 0.5rem;
        color: #495057;
    }

    .form-control {
        border: 1px solid #dee2e6;
        border-radius: 8px;
        padding: 0.75rem;
        width: 100%;
        font-family: inherit;
    }

    textarea.form-control {
        min-height: 150px;
        resize: vertical;
    }

    .image-upload {
        border: 2px dashed #dee2e6;
        border-radius: 8px;
        padding: 2rem;
        text-align: center;
        cursor: pointer;
        margin-bottom: 1.5rem;
    }

    .image-upload:hover {
        border-color: rgb(49, 45, 74);
    }

    .image-upload i {
        font-size: 2rem;
        color: #6c757d;
        margin-bottom: 1rem;
    }

    .preview-images {
        display: flex;
        gap: 1rem;
        flex-wrap: wrap;
        margin-top: 1rem;
    }

    .preview-image {
        width: 100px;
        height: 100px;
        border-radius: 8px;
        object-fit: cover;
        position: relative;
    }

    .preview-image img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        border-radius: 8px;
    }

    .preview-image .remove-image {
        position: absolute;
        top: -8px;
        right: -8px;
        background: white;
        border: none;
        border-radius: 50%;
        width: 24px;
        height: 24px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .form-actions {
        display: flex;
        justify-content: flex-end;
        gap: 1rem;
        margin-top: 2rem;
    }

    .btn {
        padding: 0.75rem 1.5rem;
        border-radius: 20px;
        border: none;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.2s;
    }

    .btn-outline,.btn:hover {
        background: none;
        border: 1px solid #dee2e6;
        color:#333;
    }

    .btn-outline:hover{
        background: #f8f9fa;
    }

    .guidelines {
        background: #f8f9fa;
        padding: 1.5rem;
        border-radius: 8px;
        margin-top: 2rem;
    }

    .guidelines h5 {
        color: rgb(49, 45, 74);
        margin-bottom: 1rem;
    }

    .guidelines ul {
        padding-left: 1.5rem;
        margin: 0;
    }

    .guidelines li {
        margin-bottom: 0.5rem;
        color: #6c757d;
    }

    @media (max-width: 768px) {
        .book-preview {
            flex-direction: column;
            align-items: center;
            text-align: center;
        }
    }
</style>
</head>

<body class="notifications_page">

    <!-- Sidebar -->
    <div class="sidebar">
        <div class="logo"><img src="{% static 'media/logo.png' %}" height="25" width="45"></div>
        <ul>
            <li>
                <a href="{% url 'home' %}">
                    <i class="ri-home-2-line "></i>
                </a>
            </li>
            <li>
                <a href="{% url 'recent' %}">
                    <i class="ri-history-line"></i>
                </a>
            </li>
            <li>
                <a href="{% url 'save' %}">
                    <i class="ri-bookmark-line"></i>
                </a>
            </li>
            <li>
                <a href="{% url 'shop' %}">
                    <i class="ri-shopping-bag-3-line"></i>
                </a>
            </li>
            <li>
                <a href="{% url 'settings' %}">
                    <i class="ri-settings-3-line"></i>
                </a>
            </li>
        </ul>
    </div>

    <!-- Main Content -->
    <div class="main_content">
        <nav class="navbar">
            <div class="search-bar">
                <i class="fa-solid fa-magnifying-glass"></i>
                <input type="text" placeholder="Search book name, edition...">
            </div>
            <div class="nav-icons">
                <i class="ri-user-line"></i>
                <i class="ri-moon-line"></i>
            </div>
        </nav>

        <div class="write-review-container">
            <div class="review-header">
                <h2>Write a Review</h2>
            </div>
    
            <div class="book-preview">
                <img src="{{book.cover_image.url}}" alt="Book Cover">
                <div class="book-info">
                    <h4>{{book.title}}</h4>
                    <p>{{book.genre}}</p>
                </div>
            </div>
    
            <form id="reviewForm" class="review-form" method="POST" action="{% url 'submit_review' book.id %}">
                {% csrf_token %}
                <div  class="rating-select">
                    <label>Your Rating</label>
                    <div id="ratingContainer" class="star-rating">
                        <i class="fas fa-star" onclick="setRating(1)"></i>
                        <i class="fas fa-star" onclick="setRating(2)"></i>
                        <i class="fas fa-star" onclick="setRating(3)"></i>
                        <i class="fas fa-star" onclick="setRating(4)"></i>
                        <i class="fas fa-star" onclick="setRating(5)"></i>
                    </div>
                </div>
            
                <div class="form-group">
                    <label>Your Review</label>
                    <textarea id="reviewContent" class="form-control" name="content" placeholder="Share your thoughts about the book. What did you like or dislike? Would you recommend it to others?"></textarea>
                </div>
            
                <div class="guidelines">
                    <h5>Review Guidelines</h5>
                    <ul>
                        <li>Focus on the book content and your reading experience</li>
                        <li>Avoid spoilers or use spoiler tags when necessary</li>
                        <li>Be honest and respectful in your feedback</li>
                        <li>Any inappropriate review will be removed by the admin</li>
                    </ul>
                </div>
            
                <div class="form-actions">
                    <button type="button" class="btn btn-outline" onclick="history.back()">Cancel</button>
                    <button type="submit"id="submitButton" class="btn "disabled>Submit Review</button>
                </div>
            </form>
            
        </div>
        <footer class="footer mt-5">
            <div class="footer-container">
                <div class="footer-about">
                    <h3>About EchoBooks</h3>
                    <p>EchoBooks is your go-to platform for unique eBooks and audiobooks authored by passionate creators. Explore our collection and dive into new stories every day.</p>
                </div>

                <div class="footer-links">
                    <h3>Quick Links</h3>
                    <ul>
                        <li><a href="#">About Us</a></li>
                        <li><a href="#">Contact</a></li>
                        <li><a href="#">Explore</a></li>
                        <li><a href="#">Blog</a></li>
                    </ul>
                </div>

                <div class="footer-contact">
                    <h3>Contact Us</h3>
                    <ul>
                        <li>Email: support@echobooks.com</li>
                        <li>Phone: +123 456 7890</li>
                        <li>Address: 123 EchoBooks St, City, Country</li>
                    </ul>
                </div>
            </div>

            <div class="footer-bottom">
                <p>&copy; 2024 EchoBooks. All Rights Reserved.</p>
                <ul class="footer-social">
                    <li><a href="#"><i class="fa-brands fa-facebook"></i></a></li>
                    <li><a href="#"><i class="fa-brands fa-x-twitter"></i></a></li>
                    <li><a href="#"><i class="fa-brands fa-instagram"></i></a></li>
                </ul>
            </div>
        </footer>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-ENjdO4Dr2bkBIFxQpeo6lXvs6A3+NcEvPbFjqkK5gFq1D7jzFeg3z0QpHNC6j7Sk"
        crossorigin="anonymous"></script>
        <script>
            function setRating(rating) {
                const stars = document.querySelectorAll('.star-rating i');
                stars.forEach((star, index) => {
                    star.classList.toggle('active', index < rating);
                });
            
                // Store the rating value
                let ratingInput = document.querySelector('input[name="rating"]');
                if (!ratingInput) {
                    ratingInput = document.createElement('input');
                    ratingInput.type = 'hidden';
                    ratingInput.name = 'rating';
                    document.querySelector('.review-form').appendChild(ratingInput);
                }
                ratingInput.value = rating;
            
                // Check if form can be submitted
                toggleSubmitButton();
            }
            
            // Function to enable/disable submit button based on rating and review content
            function toggleSubmitButton() {
                const ratingInput = document.querySelector('input[name="rating"]');
                const reviewContent = document.getElementById("reviewContent").value.trim();
                const submitButton = document.getElementById("submitButton");
            
                // Enable button only if both rating and content are provided
                if (ratingInput && ratingInput.value && reviewContent) {
                    submitButton.disabled = false;
                } else {
                    submitButton.disabled = true;
                }
            }
            
            // Add an event listener to monitor changes in the review content
            document.getElementById("reviewContent").addEventListener("input", toggleSubmitButton);
            
            // Handle form submission
            document.getElementById("reviewForm").onsubmit = async function(event) {
                event.preventDefault();
            
                const formData = new FormData(this);
            
                try {
                    const response = await fetch(this.action, {
                        method: "POST",
                        body: formData,
                        headers: {
                            "X-CSRFToken": "{{ csrf_token }}"
                        }
                    });
            
                    if (response.ok) {
                        alert("Review added successfully!");
                        setTimeout(() => {
                            window.location.href = "{% url 'reviews' book.id %}";
                        }, 1000);
                    } else {
                        alert("Unexpected error! Please try again.");
                    }
                } catch (error) {
                    alert("Error submitting the review. Please try again.");
                }
            };
            
            
    </script>
</body>
</html>
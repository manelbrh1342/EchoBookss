{% load static %}
{% load custom_filters %}

<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Home</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
        integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" type="text/css" href="{% static 'css/index.css' %} ">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />
    <link href="https://cdn.jsdelivr.net/npm/remixicon@4.1.0/fonts/remixicon.css" rel="stylesheet" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900&display=swap"
        rel="stylesheet">
        <style>
        .reviews-container {
            max-width: 1200px;
            margin: 2rem auto;
            padding: 0 1rem;
        }
        .write-review-btn {
    padding: 10px 20px;
    border-radius: 20px;
    border: none;
    background-color: rgb(49, 45, 74);
    color: white;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    text-decoration: none;
    cursor: pointer;
}

.write-review-btn:hover {
    opacity: 0.9;
    color: white;
    text-decoration: none;
}
        .reviews-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }

        .rating-summary {
            background: white;
            padding: 2rem;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            margin-bottom: 2rem;
        }

        .rating-stats {
            display: flex;
            align-items: center;
            gap: 3rem;
        }

        .overall-rating {
            text-align: center;
        }

        .overall-rating .number {
            font-size: 3rem;
            font-weight: bold;
            color: rgb(49, 45, 74);
        }

        .star-bars {
            flex-grow: 1;
        }

        .star-bar {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin: 0.5rem 0;
        }

        .progress {
            flex-grow: 1;
            height: 8px;
        }

        .progress-bar {
            background-color: rgb(49, 45, 74);
        }

        .review-card {
            background: white;
            padding: 1.5rem;
            border-radius: 12px;
            margin-bottom: 1.5rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        .review-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .reviewer-info {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .reviewer-avatar,.reviewer-avatar img{
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background-color: #e9ecef;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .review-content {
            margin: 1rem 0;
        }

        .review-actions {
            display: flex;
            gap: 1rem;
            color: #6c757d;
        }

        .review-actions button {
            border: none;
            background: none;
            color: inherit;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem;
            border-radius: 4px;
            cursor: pointer;
        }

        .review-actions button:hover {
            background-color: #f8f9fa;
        }

        .write-review-btn {
            padding: 10px 20px;
            border-radius: 20px;
            border: none;
            background-color: rgb(49, 45, 74);
            color: white;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .stars {
            color: #ffc107;
        }

        .star-count {
            color: #6c757d;
            font-size: 0.9rem;
        }
    </style>
</head>

<body class="home_page">
    <!-- Sidebar -->
    <div class="sidebar">
        <div class="logo"><img src="{% static 'media/logo.png' %}" height="25" width="45"></div>

        <ul>
            <li>
                <a href="{% url 'home' %}">
                    <i class="ri-home-2-line "></i>
                </a>
            </li>
            <li>
                <a href="{% url 'recent' %}">
                    <i class="ri-history-line"></i>
                </a>
            </li>
            <li>
                <a href="{% url 'save' %}">
                    <i class="ri-bookmark-line"></i>
                </a>
            </li>
            <li>
                <a href="{% url 'shop' %}">
                    <i class="ri-shopping-bag-3-line"></i>
                </a>
            </li>
            <li>
                <a href="{% url 'settings' %}">
                    <i class="ri-settings-3-line"></i>
                </a>
            </li>
        </ul>
    </div>
    <div class="main_content">
        <nav class="navbar">
            <div class="logoSearch">
                <div class="search-bar">
                    <i class="fa-solid fa-magnifying-glass"></i>
                    <input type="text" placeholder="Search book name, edition...">
                </div>
            </div>
    
            <div class="nav-icons">
                <i class="ri-user-line"></i>
                <i class="ri-moon-line"></i>
            </div>
        </nav>
        <div class="reviews-container">
            <div class="reviews-header">
                <h2>Reviews</h2>
                <a href="{% url 'write_review' book.id %}" class="write-review-btn">
                    <i class="ri-edit-line"></i>
                    Write a Review
                </a>
            </div>
    
            <div class="rating-summary">
                <div class="rating-stats">
                    <div class="overall-rating">
                        <div class="number">{{ overall_rating|floatformat:1 }}</div>
                        <div class="stars">
                            <!-- Full stars -->
                            {% for i in "12345" %}
                                {% if forloop.counter <= integer_rating %}
                                    <i class="fas fa-star"></i>
                                {% elif forloop.counter == integer_rating|add:1 and decimal_rating >= 0.4 %}
                                    <i class="fas fa-star-half-alt"></i>
                                {% else %}
                                    <i class="far fa-star"></i>
                                {% endif %}
                            {% endfor %}
                        </div>
                        <div class="total-reviews">{{ total_reviews }} reviews</div>
                    </div>
                    
                    
                    <div class="star-bars">
                        {% for star in "54321" %}
                        <div class="star-bar">
                            <span>{{ star }}</span>
                            <div class="progress">
                                <div class="progress-bar" style="width:{{ star_counts|get_item:star|default:0 | calculate_percentage:total_reviews }}%"></div>
                            </div>
                            <span class="star-count">{{ star_counts|get_item:star|default:0 }}</span>
                        </div>
                        {% endfor %}
                    </div>
                    
                </div>
            </div>
    
            <div class="reviews-list">
                {% for review in reviews %}
                <div class="review-card">
                    <div class="review-header">
                        <div class="reviewer-info">
                            <div class="reviewer-avatar">
                                {% if review.user.user_profile.image.url %}
                                    <img src="{{ review.user.user_profile.image.url }}">
                                {% else %}
                                    <i class="ri-user-line"></i>
                                {% endif %}
                            </div>
                            <div>
                                <h5>{{ review.user.username }}</h5>
                                <div class="stars">
                                    {% for i in "12345" %}
                                        {% if forloop.counter <= review.stars %}
                                            <i class="fas fa-star"></i>
                                        {% else %}
                                            <i class="far fa-star"></i>
                                        {% endif %}
                                    {% endfor %}
                                </div>
                            </div>
                        </div>
                        <div class="review-date">{{ review.submission_date|date:"F j, Y" }}</div>
                    </div>
                    <div class="review-content">
                        <p>{{ review.content }}</p>
                    </div>
                    <div class="review-actions">
                        <button data-review-id="{{ review.id }}">
                            <i class="{% if user in review.liked_by.all %}ri-thumb-up-fill{% else %}ri-thumb-up-line{% endif %}"></i>
                            Helpful (<span class="like-count">{{ review.likes }}</span>)
                        </button>
                    </div>
                    
                </div>
                {% endfor %}
            </div>
        </div>
        <footer class="footer footer_home">
            <div class="footer-container">
                <div class="footer-about">
                    <h3>About EchoBooks</h3>
                    <p>EchoBooks is your go-to platform for unique eBooks and audiobooks authored by passionate
                        creators. Explore our collection and dive into new stories every day.</p>
                </div>
    
                <div class="footer-links">
                    <h3>Quick Links</h3>
                    <ul>
                        <li><a href="{% url 'about' %}">About Us</a></li>
                        <li><a href="{% url 'contact' %}">Contact</a></li>
                        <li><a href="{% url 'explore' %}">Explore</a></li>
                    </ul>
                </div>
    
                <div class="footer-contact">
                    <h3>Contact Us</h3>
                    <ul>
                        <li>Email: support@echobooks.com</li>
                        <li>Phone: +123 456 7890</li>
                        <li>Address: 123 EchoBooks St, City, Country</li>
                    </ul>
                </div>
            </div>
    
            <div class="footer-bottom">
                <p>&copy; 2024 EchoBooks. All Rights Reserved.</p>
                <ul class="footer-social .footer-social-home">
                    <li><a href="#"><i class="fa-brands fa-facebook"></i></a></li>
                    <li><a href="#"><i class="fa-brands fa-x-twitter"></i></a></li>
                    <li><a href="#"><i class="fa-brands fa-instagram"></i></a></li>
                </ul>
            </div>
        </footer>
    
        <button onclick="scrollToTop()" id="backToTopBtn" title="Go to top">
            <i class="ri-arrow-up-line"></i>
        </button>
    </div>
    
        <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
        <script>
            document.addEventListener("DOMContentLoaded", function() {
                document.querySelectorAll(".review-actions button").forEach(button => {
                    button.addEventListener("click", function() {
                        const reviewId = this.dataset.reviewId;
                        const likeCountSpan = this.querySelector(".like-count");
                        const icon = this.querySelector("i");
        
                        fetch(`/review/${reviewId}/like/`, {
                            method: "POST",
                            headers: {
                                "X-CSRFToken": "{{ csrf_token }}",
                            },
                        })
                        .then(response => response.json())
                        .then(data => {
                            likeCountSpan.textContent = data.likes;
                            if (data.liked) {
                                icon.classList.remove("ri-thumb-up-line");
                                icon.classList.add("ri-thumb-up-fill");
                            } else {
                                icon.classList.remove("ri-thumb-up-fill");
                                icon.classList.add("ri-thumb-up-line");
                            }
                        });
                    });
                });
            });
        </script>
        

</body>

</html>